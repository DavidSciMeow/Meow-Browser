<metro:MetroWindow x:Class="MeowBrowser.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MeowBrowser"
        xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
        mc:Ignorable="d"
        Title="Meow's Browser" 
        Height="768" 
        Width="1366">
    <metro:MetroWindow.Resources>
        <DataTemplate x:Key="TabHeaderTemplate">
            <DockPanel LastChildFill="False" MinWidth="80">
                <TextBlock Text="{Binding}"
                           VerticalAlignment="Center"
                           Margin="5,0,20,0"
                           DockPanel.Dock="Left"
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="NoWrap"
                           ToolTip="{Binding}"/>
                <TextBlock Text="×"
                   Foreground="Gray"
                   FontWeight="Bold"
                   FontSize="16"
                   Cursor="Hand"
                   VerticalAlignment="Center"
                   DockPanel.Dock="Right"
                   Margin="0,0,5,0">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding}" Value="＋">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                    <TextBlock.InputBindings>
                        <MouseBinding Gesture="LeftClick"
                    Command="{Binding DataContext.CloseTabCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=TabItem}}"/>
                    </TextBlock.InputBindings>
                </TextBlock>
            </DockPanel>
        </DataTemplate>
        <DataTemplate x:Key="PlusTabHeaderTemplate">
            <TextBlock Text="＋" FontSize="18" FontWeight="Bold" Padding="4,0,4,0" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </DataTemplate>
        <Style TargetType="TabItem">
            <Setter Property="HeaderTemplate" Value="{StaticResource TabHeaderTemplate}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Header, RelativeSource={RelativeSource Self}}" Value="＋">
                    <Setter Property="HeaderTemplate" Value="{StaticResource PlusTabHeaderTemplate}"/>
                    <Setter Property="MinWidth" Value="32"/>
                    <Setter Property="Padding" Value="0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="SingleRowTabControl" TargetType="TabControl">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <DockPanel>
                            <ScrollViewer DockPanel.Dock="Top"
                                          HorizontalScrollBarVisibility="Auto"
                                          VerticalScrollBarVisibility="Disabled"
                                          Focusable="false">
                                <TabPanel x:Name="HeaderPanel"
                                          IsItemsHost="True"
                                          Panel.ZIndex="1"
                                          Background="Transparent"
                                          Height="32"
                                          Margin="0,0,0,0"
                                          KeyboardNavigation.TabIndex="1"/>
                            </ScrollViewer>
                            <ContentPresenter x:Name="PART_SelectedContentHost"
                                              ContentSource="SelectedContent"
                                              Margin="0"
                                              KeyboardNavigation.TabIndex="2"/>
                        </DockPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </metro:MetroWindow.Resources>
    <Border x:Name="MainBorder" CornerRadius="8" Background="Transparent">
        <DockPanel>
            <!-- 菜单栏 -->
            <Menu DockPanel.Dock="Top">
                <MenuItem Header="工具">
                    <MenuItem Name="PluginManagerMenuItem" Header="插件管理"/>
                    <MenuItem Name="ThemeSettingsMenuItem" Header="主题设置"/>
                </MenuItem>
            </Menu>
            <!-- Tab 页 -->
            <TabControl Name="BrowserTabControl" SelectionChanged="BrowserTabControl_SelectionChanged"
                        TabStripPlacement="Top"
                        Style="{StaticResource SingleRowTabControl}">
                <!-- Tab 页内容由代码动态添加 -->
                <TabItem Header="＋" IsEnabled="True"/>
            </TabControl>
        </DockPanel>
    </Border>
</metro:MetroWindow>
